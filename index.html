<html>
<head>
  <title>Bike Nashville</title>
  <script src='https://api.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css' rel='stylesheet' />
  <link rel="stylesheet" type="text/css" href="css/map.css">
  <link rel='stylesheet' src='css/mapbox-directions.css' type='text/css'/>
  <link rel='stylesheet' href='css/mapbox-geocoder.css' type='text/css' />
  <script src="js/mapContent.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.0.1/mapbox-gl-geocoder.js'></script>
  <script src='js/directions.js'></script>
</head>

<body>
  <div id="Nashville_Interactive" class="tabcontent">
    <div id="map"></div>
    <div class='map-overlay' id='features'>
      <div id='pd'></div>
    </div>
    <div class='map-overlay' id='legend'></div>
  </div>

  <script>
    $(function(){
      $("#mapContent").load("html/mapContent.html"); 
    });

    var blLatLong = [-86.899383, 36.073240];
    var trLatLong = [-86.684192, 36.233608];
    var bounds = [blLatLong, trLatLong];
    var boundsArray = [blLatLong[0], blLatLong[1], trLatLong[0], trLatLong[1]];

    mapboxgl.accessToken = 'pk.eyJ1IjoibGFuZWZlbGtlciIsImEiOiJjaXltMHlid3owMDAwMndwZ25oZ3E2ZndvIn0.oq1pkRiMAbhvGPPzD3nq2A';
    var map = new mapboxgl.Map({
        container: 'map',
        maxZoom: 18,
        style: 'mapbox://styles/lanefelker/ciyjbdp1400212ro9lkyl5f60',
        zoom: 10,
        center: [-86.780248, 36.164267],
        maxBounds: bounds
    });

    var directions = new MapboxDirections({
      accessToken: mapboxgl.accessToken,
      geocoder: {bbox: boundsArray},
      profile: 'cycling'
    });

    // map.fitBounds([[-86.897640, 36.090449], [-86.689192, 36.213608]]);

    map.addControl(directions, 'top-right');
    document.getElementById('mapbox-directions-profile-cycling').checked = true;
    document.getElementsByClassName('directions-icon-reverse')[0].style.display = 'none';
    document.getElementsByClassName('directions-control-instructions')[0].style.display = 'none';
  

    map.on('load', function() {

      var legend_layers = ["Bike Lane", "Bike Lane On Busy Road", "Shared Road", "Shared Busy Road"];

      legend_layers.forEach(function(layer) {
        var color = map.getPaintProperty(layer, 'line-color');
        var item = document.createElement('div');
        var key = document.createElement('span');

        key.className = 'legend-key';
        key.style.backgroundColor = color;
        var value = document.createElement('span');

        if (layer == "Bike Lane") {
          value.innerHTML = layer + " Or Greenway";
        } else if (layer == "Shared Road") {
          value.innerHTML = "Road Shared With Bikes";
        } else if (layer == "Shared Busy Road") {
          value.innerHTML = "Busy Road Shared With Bikes";
        } else {
          value.innerHTML = layer;
        }

        if (layer == "Bike Lane On Busy Road" || layer == "Shared Busy Road") {
          var dash1 = document.createElement('span');
          var dash2 = document.createElement('span');;
          dash1.className = 'dash';
          dash2.className = 'dash';
          key.appendChild(dash1);
          key.appendChild(dash2);
        }
        item.appendChild(key);
        item.appendChild(value);
        legend.appendChild(item);
      });
    });

    var info_layers = ["Bike Lane", "Protected Bike Lane", "Greenway", "Bike Lane On Busy Road", "Shared Road", "Shared Busy Road"];

    map.on('mousemove', function(e) {

      var features = map.queryRenderedFeatures(e.point, {
        layers: info_layers
      });

      if (features.length > 0) {
        document.getElementById('pd').innerHTML = '<p>' + features[0].layer.id + '</p>';
      } else {
        document.getElementById('pd').innerHTML = '';
      }
    });
  </script>
</body>
</html>